---
title: "Load_NOAH_Data"
author: "Annika Eisele (Helmholtz-Zentrum Geesthacht)" 
co-author: "Arthur Carpet (Universite de Liege)"
comment: "Text by A.Eisele. R-coding alterations by A.Eisele based on R-scripts provided by A.Carpet"" 
date: "18 Oktober 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This is a script to upload NOAH observation data and convert them to a data frame in R for further processing. 

## First Example: NOAH C
As first example measured data at NOAH station C, sampled at two different campaigns (HE432 in September, 2014 and HE447 in July 2015), are edited.

### Define usage


### Load necessary packages
```{r, echo=FALSE}
require(reshape2)
require(gdata)
library(readxl)
require(plyr)
library(ggmap)

```

### Loading Nutrient data
```{r}
NOAHnutrients<- read.xls("NOAH_C_Nutrients.xlsx", 
                         na.strings=c("#"),as.is = TRUE,fileEncoding="latin1",header=T) #Loading NOAH Nutrient data

NOAHnutforp<-melt(NOAHnutrients,id.vars=c("Station","Cruise","depth","yearday","date")) #creating data frame

NOAHnutforp2<-subset(NOAHnutforp,variable %in% c("NOx","NO2","NO3","NH4_OPA","PO4","Si_OH_4")) #creating subset of data


#Plot nutrient data according to cruises
ggplot(NOAHnutforp, aes(y=depth, x=value, color=factor(Cruise)))+ 
    geom_point()+geom_path()+
    facet_wrap(~variable,scales="free")+ylim(-35,10)+scale_color_discrete(name="Cruise")+
    ylab("Depth [cm]")+xlab("value [micromol/L]")

#Plot subset of nutrient data
ggplot(NOAHnutforp2, aes(y=depth, x=value, color=factor(Cruise)))+ 
    geom_point()+geom_path()+
    facet_wrap(~variable,scales="free")+ylim(-35,10)+scale_color_discrete(name="Cruise")+
    ylab("Depth [cm]")+xlab("value [micromol/L]")
```



### Loading Oxygen data
not available yet
```{r}
# NOAHO2<- read.xls("NOAH_C_O2.xlsx", 
#                    na.strings=c("#"),as.is = TRUE,fileEncoding="latin1")
  
#  NOAHO2forp<-melt(NOAHO2,id.vars=c("Station","Cruise","depth","yearday","date")) #creating data frame

##Plot oxygen data according to cruises
#ggplot(NOAHO2forp, aes(y=depth, x=value, color=factor(Cruise)))+ 
#    geom_point()+geom_path()+
#    facet_wrap(~variable,scales="free")+scale_color_discrete(name="Cruise")+
#    ylab("Depth [cm]")+xlab("value [mmol/m^2/d]")
```



### Loading benthic fluxes
```{r}
  NOAHfluxes<- read.xls("NOAH_C_Fluxes.xlsx", na.strings=c("#"),as.is = TRUE,fileEncoding="latin1")
  
  NOAHflforp<-melt(NOAHfluxes,id.vars=c("Station","Cruise","depth","yearday","date","Lon","Lat",
                                        "Permeability","O2Penetration","O2PenetrationERR")) #creating data frame

#Plot nutrient data according to cruises
ggplot(NOAHflforp, aes(y=depth, x=value, color=factor(Cruise)))+ 
    geom_point()+geom_path()+
    facet_wrap(~variable,scales="free")+scale_color_discrete(name="Cruise")+
    ylab("Depth [cm]")+xlab("value [mmol/m^2/d]")

#ggplot(melt(NOAHfluxes,id.vars=c("Station","Lon","Lat")),aes(x=Station, y=))

```



## Mapping NOAH Stations
```{r}
#Location of NOAH Stations
NOAH_C_Loc <- c(8.015, 54.07)

NSLoc_stamen <- c(4, 53, 9, 56)
NSLoc_google <- c(3, 53, 10, 56)


#Mapping with stamen
NSMap_stamen <- get_map(location=NSLoc_stamen,source="stamen", maptype="watercolor")
ms<-ggmap(NSMap_stamen)
ms1<-
  ms+
  geom_point(data=NOAHfluxes, aes(x = Lon, y = Lat, colour=factor(Station),label=Station),size=10)+
  geom_text( data=NOAHfluxes, aes(x = Lon, y = Lat, label=Station),hjust=.5, vjust=.5,size=2)
ms1


#Mapping with google
NSMap_google <- get_map(location=NSLoc_google,source="google", maptype="satellite", crop=FALSE)
mg<-ggmap(NSMap_google)
mg1<-
  mg+
  geom_point(data=NOAHfluxes, aes(x = Lon, y = Lat, colour=factor(Station),label=Station),size=10)+
  geom_text( data=NOAHfluxes, aes(x = Lon, y = Lat, label=Station),hjust=.5, vjust=.5,size=2)
mg1

```

